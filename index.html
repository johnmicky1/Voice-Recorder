<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Script Reader & Voice Recorder</title>
<style>
  :root { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; }
  body { background:#0b1220; color:#e9eef7; margin:0; padding:2rem; }
  .wrap { max-width:920px; margin:auto; display:grid; gap:1.25rem; }
  .card { background:#141c2f; border:1px solid #263049; border-radius:18px; padding:1.25rem; box-shadow:0 8px 24px rgba(0,0,0,.35); }
  h1 { font-size:1.6rem; margin:.2rem 0 1rem; }
  h2 { font-size:1.1rem; margin:.2rem 0 .8rem; color:#bcd0ff; }
  textarea { width:100%; min-height:130px; border:1px solid #32405f; border-radius:12px; padding:.8rem; background:#0f1726; color:#e9eef7; resize:vertical; }
  .row { display:flex; flex-wrap:wrap; gap:.6rem; align-items:center; margin-top:.6rem; }
  button,a.btn { border:1px solid #3b4a72; background:#1b2742; color:#e9eef7; padding:.55rem .95rem; border-radius:12px; cursor:pointer; transition:.15s; text-decoration:none; }
  button:hover, a.btn:hover { background:#23345a; transform:translateY(-1px); }
  button:disabled { opacity:.5; cursor:not-allowed; transform:none; }
  audio { width:100%; height:38px; margin-top:.6rem; }
  small { color:#9fb2d9; }
  .pill { font-size:.82rem; background:#0f1a32; border:1px solid #2a3a61; border-radius:999px; padding:.25rem .55rem; }
</style>
</head>
<body>
  <div class="wrap">
    <h1>Script Reader & Voice Recorder</h1>

    <!-- Voice Recorder -->
    <div class="card" id="recCard">
      <h2>1) Record your voice</h2>
      <div class="row">
        <button id="startBtn">üéôÔ∏è Start recording</button>
        <button id="stopBtn" disabled>‚èπÔ∏è Stop</button>
        <button id="playBtn" disabled>‚ñ∂Ô∏è Play</button>
        <a id="dlBtn" class="btn" download disabled>‚¨áÔ∏è Download</a>
        <span id="formatPill" class="pill">format: ‚Ä¶</span>
      </div>
      <audio id="player" controls preload="metadata"></audio>
      <small id="recHelp">Allow microphone access when prompted. Recording is local in your browser.</small>
    </div>

    <!-- Script TTS -->
    <div class="card">
      <h2>2) Speak a script (Text-to-Speech)</h2>
      <textarea id="scriptBox" placeholder="Paste or type your script here‚Ä¶"></textarea>
      <div class="row">
        <button id="speakBtn">üîä Speak</button>
        <button id="stopSpeakBtn">‚èπÔ∏è Stop speaking</button>
        <label class="pill">Rate <input id="rate" type="range" min="0.6" max="1.6" step="0.05" value="1"></label>
        <label class="pill">Pitch <input id="pitch" type="range" min="0.6" max="1.6" step="0.05" value="1"></label>
      </div>
      <small>Tip: Use the recorder above to capture <em>your own voice</em> reading the script. (Browser security doesn‚Äôt allow recording system audio from TTS directly.)</small>
    </div>

    <small>Notes: Uses <code>MediaRecorder</code> for mic capture and the Web Speech API for TTS. Best in Chrome/Edge. Some browsers may choose <em>webm/ogg/mp4</em> audio formats.</small>
  </div>

<script>
(() => {
  // ---- Recorder ----
  const startBtn = document.getElementById('startBtn');
  const stopBtn  = document.getElementById('stopBtn');
  const playBtn  = document.getElementById('playBtn');
  const dlBtn    = document.getElementById('dlBtn');
  const player   = document.getElementById('player');
  const formatPill = document.getElementById('formatPill');

  let mediaRecorder, chunks = [], stream;

  // Pick the best-supported audio mime type
  const preferredTypes = [
    'audio/webm;codecs=opus',
    'audio/ogg;codecs=opus',
    'audio/mp4;codecs=mp4a.40.2',
    'audio/webm',
    'audio/ogg'
  ];
  const chosenType = preferredTypes.find(t => window.MediaRecorder && MediaRecorder.isTypeSupported(t)) || '';
  formatPill.textContent = 'format: ' + (chosenType || 'browser default');

  async function startRecording() {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream, chosenType ? { mimeType: chosenType } : {});
      chunks = [];

      mediaRecorder.ondataavailable = e => { if (e.data && e.data.size > 0) chunks.push(e.data); };
      mediaRecorder.onstop = () => {
        const type = mediaRecorder.mimeType || 'audio/webm';
        const blob = new Blob(chunks, { type });
        const url  = URL.createObjectURL(blob);
        player.src = url;
        playBtn.disabled = false;

        // name with sensible extension
        const ext = type.includes('mp4') ? '.mp4' :
                    type.includes('ogg') ? '.ogg' :
                    type.includes('webm') ? '.webm' : '.wav';
        dlBtn.href = url;
        dlBtn.download = 'recording_' + new Date().toISOString().replace(/[:.]/g,'-') + ext;
        dlBtn.removeAttribute('disabled');
      };

      mediaRecorder.start();
      startBtn.disabled = true; stopBtn.disabled = false; playBtn.disabled = true;
      dlBtn.setAttribute('disabled','');
    } catch (err) {
      alert('Mic access failed: ' + err.message);
    }
  }

  function stopRecording() {
    if (mediaRecorder && mediaRecorder.state !== 'inactive') {
      mediaRecorder.stop();
    }
    if (stream) {
      stream.getTracks().forEach(t => t.stop());
      stream = null;
    }
    startBtn.disabled = false; stopBtn.disabled = true;
  }

  startBtn.onclick = startRecording;
  stopBtn.onclick  = stopRecording;
  playBtn.onclick  = () => player.play();

  // ---- Text-to-Speech (TTS) ----
  const scriptBox = document.getElementById('scriptBox');
  const speakBtn  = document.getElementById('speakBtn');
  const stopSpeakBtn = document.getElementById('stopSpeakBtn');
  const rate = document.getElementById('rate');
  const pitch = document.getElementById('pitch');

  speakBtn.onclick = () => {
    const text = scriptBox.value.trim();
    if (!text) return alert('Please enter some text.');
    if (!('speechSynthesis' in window)) return alert('This browser does not support speech synthesis.');

    const u = new SpeechSynthesisUtterance(text);
    u.rate  = parseFloat(rate.value);
    u.pitch = parseFloat(pitch.value);
    speechSynthesis.cancel(); // stop anything already speaking
    speechSynthesis.speak(u);
  };
  stopSpeakBtn.onclick = () => speechSynthesis.cancel();
})();
</script>
</body>
</html>
